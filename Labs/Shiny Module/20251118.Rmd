---
title: "Quiz 3 prep"
author: "Fushuai Jiang"
date: "`r Sys.Date()`"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)
library(ggplot2)
library(dplyr)
library(socviz)
```






All of the exercises will be using the sub-sampled dataset `df`. 

```{r}
df <- gss_sm |> 
  select(age, wtssall, childs, sex, income16, bigregion, partyid, zodiac) |> 
  slice_sample(n = 2000)
```



1. Write a minimal shiny app that allows the user to pick from `c("age", "wtssall", "childs")` and output the five-number statistics using `summary()` and `verbatimTextOutput`.


```{r}
library(shiny)

ui <- fluidPage(
  selectInput("var", "Select a Variable", choices = c("age", "wtssall", "childs")),
  verbatimTextOutput("summary")
)

server <- function(input, output, session) {
  output$summary <- renderPrint({
    df |> pull(input$var) |> summary()
  })
}

shinyApp(ui, server)
```


2. Add an action button to the app in 1 with text "Five Numbers", such that the output will only display/update after you click the button. 


```{r}

library(shiny)

ui <- fluidPage(
  selectInput("var", "Select a Variable", choices = c("age", "wtssall", "childs")),
  actionButton("action", "Five Numbers"),
  verbatimTextOutput("summary")
)

server <- function(input, output, session) {
  
  data <- eventReactive(input$action, {df |> pull(input$var)})
  
  output$summary <- renderPrint({
    data() |> summary()
  })
}

shinyApp(ui, server)
```


3. Write a shiny app that allow the user to choose from `c("age", "wtssall", "childs")` and display a density plot of that variable using `geom_density`. 

```{r}
library(shiny)

ui <- fluidPage(
  selectInput("var", "Select a Variable", choices = c("age", "wtssall", "childs")),
  plotOutput("plot")
)

server <- function(input, output, session) {
  output$plot <- renderPlot({
    ggplot(df, aes(x = .data[[input$var]])) + geom_density()
  })
  
  ## Note that `df |> select(input$var)` won't work because it returns a tibble with a dynamically named column, and Shiny internally serializes the reactive inputs (including input$var). In some situations, this leads to a named vector to JSON conversion problem.
  
  ## Note that `aes(x = input$var)` won't work either, because `input$var` is a string, so `ggplot(df, aes(x = input$var))` tells ggplot to plot the string `input$var` on the x-asix. On the other hand, `.data[[input$var]]` means **take the column whose name equal to the string in `input$var`**
}


shinyApp(ui, server)
```


4. Build on top of the app in part 3 and accomplish the following:

  - Add an action button with text "Visualize" so the plot only displays after clicking the button
  - Facet the plot by zodiac sign
  
```{r}
library(shiny)

ui <- fluidPage(
  selectInput("var", "Select a Variable", choices = c("age", "wtssall", "childs")),
  actionButton("action", "Visualize"),
  plotOutput("plot")
)

server <- function(input, output, session) {
  
  df_reactive <- eventReactive(input$action, {df})
  
  output$plot <- renderPlot({
    ggplot(df_reactive(), aes(x = .data[[input$var]])) + geom_density() + facet_wrap(~zodiac)
  })
}

shinyApp(ui, server)
```


5. (The quiz won't be this hard) Build on top of part 4, so that the user can choose faceted variables from `c("zodiac", "partyid", "bigregion")`


```{r}
library(shiny)

ui <- fluidPage(
  selectInput("var", "Select a Variable", choices = c("age", "wtssall", "childs")),
  selectInput("facet", "Select a variable to facet", choices = c("zodiac", "partyid", "bigregion")),
  actionButton("action", "Visualize"),
  plotOutput("plot")
)

server <- function(input, output, session) {
  
  df_reactive <- eventReactive(input$action, {df})
  facet_reactive <- eventReactive(input$action, {input$facet})
  
  output$plot <- renderPlot({
    ggplot(df_reactive(), aes(x = .data[[input$var]])) + geom_density() + facet_wrap(~.data[[facet_reactive()]])
  })
}

shinyApp(ui, server)
```

