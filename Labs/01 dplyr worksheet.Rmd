---
title: "Worksheet: data transformation with `dplyr`"
output: html_document
---

```{r setup, include=FALSE}
# packages used by the exercises
library(dplyr)
library(nycflights13)
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{css, echo=FALSE}
ol.problems {
  counter-reset: prob;
  list-style: none;
  padding-left: 0;
}
ol.problems > li {
  counter-increment: prob;
  margin-bottom: 1.3em;
}
ol.problems > li::before {
  content: "Problem " counter(prob) ". ";
  font-weight: bold;
  display: inline-block;
  margin-right: 0.2em;
}
.choices {
  list-style: none;
  padding-left: 1.3em;
}
.choices li {margin: 0.15em 0;}
```


## `cars` dataset


<ol class="problems">

<li> Look at the `cars` dataset. Do the following (in one-pipeline if you are fluent) 

- a) Select only `speed`.  
- b) Filter rows with `speed > 15`.  
- c) Create `dist_per_speed = dist / speed`.  
- d) Arrange by decreasing `dist_per_speed`.  
- e) Summarize the averages of all three variables.

</li>

<li> 
Summary and groups

- a) Create a categorical variable `speed_group` where `speed <= 10` → "slow", `speed <= 20` → "medium", else "fast".  
- b) For each `speed_group`, compute `n`, `mean(dist)`, `sd(dist)`.  
- c) Use `filter()` + `slice_max()` to show the top 3 observations by `dist` for the "fast" group.
</li>




<li> Consider the `nycflights13::flights` dataset in class. Do the following (in one-pipeline when it makes sense) 

- a) Select `year, month, day, carrier, origin, dest, dep_delay, arr_delay, distance, air_time`.  
- b) Filter flights in **June** with `dep_delay > 30`. How many were there?  
- c) Filter flights by carrier `"UA"` (United) and `origin == "JFK"`; show a preview (first 6).
- d) Create `gain = dep_delay - arr_delay` and think about what `gain` means. Show summary stats of `gain`
- f) Add a logical column `long_flight = distance > 1000`.
</li>


<li>
Row operations.

- a) Arrange to find the 10 flights with largest `arr_delay`.  
- b) Arrange to find the 10 fastest flights by `speed`.  
- c) Which flight (carrier + flight number) has the highest `gain`?
</li>

<li>
Groups and summaries.

- a) For each `month`, compute average `dep_delay` and average `arr_delay`. Which month looks worst?  
- b) For each `carrier`, compute `mean(arr_delay, na.rm=TRUE)` and `n()`; show carriers with at least 200 flights.  
- c) For each `carrier`, compute the proportion of flights with `arr_delay <= 0` (on-time or early).
</li>

<li>
Look up `dplyr::join` and `nycflights13::airlines`

- a) Join `flights` with `airlines` to get `name` for each `carrier`. Show a small result.  
- b) Explain a situation where a `left_join` vs `inner_join` matters here.
- c) Explain (in one or two sentences) how duplicates in the right table affect a `left_join` (e.g., joining `planes` to `flights` if `planes` had duplicate `tailnum`).  
- d) Write R code that detects duplicate `tailnum` in `planes` and shows the duplicates.  
- e) Suggest a safe join strategy when duplicates exist.
</li>





</ol>



