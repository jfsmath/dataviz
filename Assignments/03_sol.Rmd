---
title: "Assignment 3"
author: "Your Name and UID"
date: "Due: 11:59 PM, September 22, 2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(nycflights13)
library(dplyr)
library(tidyverse)
```


## Submission Instruction:

- Submit: a single HTML document
- Show all code and output


## Exercise 1

Solve the following exercises from [R for Data Science](https://r4ds.hadley.nz/)

- [Section 3.2.5](https://r4ds.hadley.nz/data-transform.html#exercises)

In a single pipeline (even if it may not make sense for the last few after the initial filtering):

```{r}
flights |> 
  filter(arr_delay >= 120) |>
  filter(dest %in% c("IAH", "HOU")) |>
  filter(carrier %in% c("UA", "AA", "DL")) |>
  filter(month %in% c(7,8,9)) |> 
  filter(dep_delay <= 0) |> 
  mutate(gain = arr_delay - dep_delay) |> 
  filter(gain >= 30)
```

- [Section 3.3.5](https://r4ds.hadley.nz/data-transform.html#exercises-1)

  1. We expect the following pipeline to return zero, but this is not the case. What? -- overnight flights! 

```{r}
flights %>% {.$dep_delay == .$dep_time - .$sched_dep_time} |> sum(na.rm = T)
```
  2. Whatever works
  3. It doesn't create duplicate
```{r}
flights |> select(year, year, everything())
```

  4. In the following code, `"whatever"` is an extra variable
```{r}
variables <- c("year", "month", "day", "dep_delay", "arr_delay", "whatever")
flights |> select(any_of(variables))
```
  
  5. See `?select`
```{r}
flights |> select(contains("TIME", ignore.case = F))
```
  6. 
```{r}
flights |> rename(air_time_min = air_time) |> select(air_time_min, everything())
```

  7. A fix:
```{r}
flights |> select(tailnum, everything()) |> arrange(arr_delay)
```
  

- [Section 3.5.7](https://r4ds.hadley.nz/data-transform.html#exercises-2)

  1. Find the flights that are most delayed upon departure from each destination.
```{r}
flights |> 
  filter(arr_delay >= 0) |>
  group_by(carrier, origin, dest) |> 
  summarize(
    total = n(), 
    avg = mean(arr_delay)
  ) |> 
  arrange(desc(avg))
```

  2. Which carrier has the worst average delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? 
```{r}
flights |> 
  group_by(dest) |> 
  slice_max(order_by = arr_delay, n = 1)
```
  
  3. How do delays vary over the course of the day? Illustrate your answer with a plot.
```{r}
flights |> 
  group_by(sched_dep_time) |> 
  summarize(avg_delay = mean(dep_delay, na.rm = T)) |> 
  ggplot(aes(x = sched_dep_time, y = avg_delay)) + geom_line()
# We will fix the time in a later lecture
```
  
  4. 
```{r}
dim(flights)
flights |> slice_min(order_by = arr_delay, n = 3, with_ties = F) #pick the minimum 3
flights |> slice_min(order_by = arr_delay, n = -3, with_ties = F) # drop the maximum 3
```
  
  5. It counts the number of observations corresponding to that variable, the sort option sorts the output table
```{r}
flights |> count(carrier, sort = T)
flights |> count(carrier, sort = F)
```
  
  
## Exercise 2

1. Construct a new dataframe called `oecd2` by joining `oecd_le` and `gapminder` by country name using the function `left_join`. (See `?left_join`)
```{r}
library(socviz)
oecd2 <- left_join(oecd_le, gapminder, by = "country")
oecd2
```

2. Are there countries that are missing `continent` information? How to find all of these countries? (You may find the function `is.na` helpful)
```{r}
sum(is.na(oecd2$continent))
unique(oecd2$country[is.na(oecd2$continent)])
```

3. Assign the correct continents to these countries.


